@model BusinessLogicLayer.DTOs.Admin.ManagerClass.ClassUpdateDto

@{
    ViewData["Title"] = "Edit Class";
}

<div class="container mt-4">

    <h2 class="fw-bold mb-3">Edit Class</h2>

    <form asp-action="Edit" method="post" enctype="multipart/form-data">
        <input type="hidden" asp-for="ClassId" />

        <div class="row">
            <!-- Left Column -->
            <div class="col-md-6">
                <!-- Class Name -->
                <div class="mb-3">
                    <label class="form-label fw-semibold">Class Name</label>
                    <input asp-for="ClassName" class="form-control" />
                    <span asp-validation-for="ClassName" class="text-danger"></span>
                </div>

                <!-- Semester -->
                <div class="mb-3">
                    <label class="form-label fw-semibold">Semester</label>
                    <select asp-for="SemesterId" class="form-control" asp-items="ViewBag.Semesters">
                        <option value="">-- Select Semester --</option>
                    </select>
                    <span asp-validation-for="SemesterId" class="text-danger"></span>
                </div>

                <!-- Subject -->
                <div class="mb-3">
                    <label class="form-label fw-semibold">Subject</label>
                    <select asp-for="SubjectId" class="form-control" asp-items="ViewBag.Subjects">
                        <option value="">-- Select Subject --</option>
                    </select>
                    <span asp-validation-for="SubjectId" class="text-danger"></span>
                </div>
            </div>

            <!-- Right Column -->
            <div class="col-md-6">
                <!-- Teacher -->
                <div class="mb-3">
                    <label class="form-label fw-semibold">Teacher</label>
                    <div class="d-flex align-items-center gap-2 mb-2">
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#teacherModal">
                            Chọn giáo viên
                        </button>
                        <div id="selectedTeacherName" class="text-primary fw-bold"></div>
                    </div>
                    <input type="hidden" asp-for="TeacherId" id="TeacherId" />
                    <span asp-validation-for="TeacherId" class="text-danger"></span>
                </div>

                <!-- Students -->
                <div class="mb-3">
                    <label class="form-label fw-semibold">Students</label>
                    <div class="d-flex gap-2 mb-2">
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#studentModal">
                            Xem danh sách học sinh
                        </button>
                        <div id="selectedStudentsDisplay" class="text-success fw-bold"></div>
                    </div>

                    <!-- Import Excel -->
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Import Students from Excel</label>
                        <input asp-for="StudentExcelFile" type="file" class="form-control" />
                        <span asp-validation-for="StudentExcelFile" class="text-danger"></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="d-flex gap-2 mt-3">
            <button type="submit" class="btn btn-warning">
                <i class="bi bi-save"></i> Save Changes
            </button>
            <a href="@Url.Action("Index", "Class")" class="btn btn-secondary">Cancel</a>
        </div>
    </form>

</div>
<style>
    #teacherModal .form-check,
    #studentModal .form-check {
        display: flex !important;
        align-items: center;
        gap: 8px;
        /* bỏ padding/margin mặc định gây lệch */
        padding-left: 0 !important;
        margin-left: 0 !important;
    }

    #teacherModal .form-check-input,
    #studentModal .form-check-input {
        margin-left: 0 !important;
        transform: scale(1.2); /* optional: radio to rõ hơn */
    }
</style>
<!-- STUDENT MODAL -->
<div class="modal fade" id="studentModal">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">

            <div class="modal-header py-2">
                <h5 class="modal-title">Danh sách học sinh hiện tại</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">
                @foreach (var s in ViewBag.Students)
                {
                    <div class="form-check">
                        <label class="form-check-label">@s.Text</label>
                    </div>
                }
            </div>

          
        </div>
    </div>
</div>

<!-- TEACHER MODAL -->
<div class="modal fade" id="teacherModal">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">

            <div class="modal-header py-2">
                <h5 class="modal-title">Chọn giáo viên</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">
                @foreach (var t in ViewBag.Teachers)
                {
                    bool isChecked = t.Value == Model.TeacherId.ToString();
                    <div class="form-check">
                        <input class="form-check-input teacher-radio"
                               type="radio"
                               name="TeacherSelect"
                               value="@t.Value"
                               data-name="@t.Text"
                               id="t_@t.Value"
                               @(isChecked ? "checked" : "") />

                        <label class="form-check-label" for="t_@t.Value">@t.Text</label>
                    </div>
                }
            </div>

            <div class="modal-footer py-2">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="confirmTeacher">Xong</button>
            </div>

        </div>
    </div>
</div>

<script>
    // Confirm Students
     document.getElementById("confirmStudents").onclick = function () {
        var selectedIds = [];
        var selectedNames = [];

        $(".student-checkbox:checked").each(function () {
            selectedIds.push($(this).val());      
            selectedNames.push($(this).data("name")); 
        });

        $("#studentInputs").remove();

        if (selectedIds.length > 0) {
            var form = $("form");
            var container = $("<div id='studentInputs'></div>");
            selectedIds.forEach(function (id) {
                container.append('<input type="hidden" name="StudentIds" value="' + id + '" />');
            });
            form.append(container);
        }

        document.getElementById("selectedStudentsDisplay").innerText =
            selectedNames.length > 0
                ? "Đã chọn: " + selectedNames.join(", ")
                : "Chưa chọn học sinh";
    };


    document.getElementById("confirmTeacher").onclick = function () {
        var selected = $(".teacher-radio:checked");

        if (selected.length > 0) {
            var teacherId = selected.val();
            var teacherName = selected.data("name");

            $("#TeacherId").val(teacherId);
            $("#selectedTeacherName").text("Giáo viên: " + teacherName);
        }
    };
</script>
